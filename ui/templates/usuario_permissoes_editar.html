<!DOCTYPE html>
{% load static %}
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Editar permissões</title>
  <link rel="stylesheet" href="{% static 'css/styles.css' %}" />
</head>
<body class="painel-page">
  {% include '_painel_sidebar.html' %}
  <main class="painel-content">
    <header class="painel-header">
      <h2>Editar permissões de {{ target_user.username }}</h2>
      <p>{{ nome_completo }}</p>
      <p><a href="{% url 'accounts:usuarios' %}">Voltar para usuários</a></p>
    </header>

    <form method="post" class="login-card form-card">
      {% csrf_token %}
      <input type="hidden" name="action" value="save_permissions" />

      {% if foto_url %}
        <p><img class="confirmation-photo" src="{{ foto_url }}" alt="Foto de {{ nome_completo }}" /></p>
      {% endif %}

      <label>{{ form.profiles.label }}</label>
      <div class="checkbox-grid">
        {{ form.profiles }}
      </div>
      {% if form.profiles.errors %}<p class="field-error">{{ form.profiles.errors|join:" " }}</p>{% endif %}

      <label class="checkbox-full">
        {{ form.is_active }}
        Usuário ativo
      </label>
      {% if form.is_active.errors %}<p class="field-error">{{ form.is_active.errors|join:" " }}</p>{% endif %}

      <button type="submit" class="primary">Salvar permissões</button>
    </form>

    <form method="post" class="login-card form-card">
      {% csrf_token %}
      <input type="hidden" name="action" value="merge_user" />
      <h3>Unificar login</h3>
      <p>Use quando a mesma pessoa estiver cadastrada em dois logins diferentes.</p>
      <label for="merge-username">Username para unificar neste login</label>
      <input id="merge-username" type="text" name="merge_username" list="merge-candidates" placeholder="Digite o username" required />
      <datalist id="merge-candidates">
        {% for username in merge_candidates %}
          <option value="{{ username }}"></option>
        {% endfor %}
      </datalist>
      <button type="submit" class="secondary">Unificar usuário</button>
    </form>
  </main>
</body>
</html>
