<!DOCTYPE html>
{% load static %}
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Resumo do cadastro</title>
  <link rel="stylesheet" href="{% static 'css/styles.css' %}" />
  <style>
    .resumo-progress {
      margin-top: .65rem;
      padding: .75rem .9rem;
      border: 1px solid #dbeafe;
      background: #f8fbff;
      border-radius: 12px;
    }
    .resumo-meta {
      display: flex;
      flex-wrap: wrap;
      gap: .75rem;
      margin-top: .35rem;
    }
    .resumo-pill {
      display: inline-flex;
      align-items: center;
      gap: .35rem;
      border-radius: 999px;
      background: #eff6ff;
      color: #1d4ed8;
      padding: .35rem .65rem;
      font-weight: 700;
      font-size: .85rem;
    }
    .summary-card {
      display: grid;
      grid-template-columns: 78px 1fr;
      gap: .8rem;
      align-items: start;
    }
    .summary-photo {
      width: 78px;
      height: 104px;
      object-fit: cover;
      border-radius: 10px;
      border: 1px solid #cbd5e1;
      background: #fff;
      box-shadow: 0 8px 16px rgba(15, 23, 42, .06);
    }
    .summary-photo-fallback {
      width: 78px;
      height: 104px;
      border-radius: 10px;
      border: 1px dashed #cbd5e1;
      display: grid;
      place-items: center;
      color: #64748b;
      font-size: .8rem;
      background: #f8fafc;
    }
  </style>
</head>
<body>
  <div class="page-shell">
    <div class="branding">
      <p class="eyebrow">Resumo</p>
      <h1>Confirmacao das fichas</h1>
      <p class="subtitle">Confira os itens e siga o fluxo conforme a quantidade informada no início.</p>
      <div class="resumo-progress">
        <strong>Progresso:</strong> {{ preview_aventureiros_count }}/{{ target_aventureiros_count }} aventureiro(s) preparado(s) para finalização.
        <div class="resumo-meta">
          <span class="resumo-pill">Salvos: {{ saved_aventureiros_count }}</span>
          <span class="resumo-pill">Restantes: {{ remaining_aventureiros_count }}</span>
        </div>
      </div>
    </div>
    <main class="login-card">
      <section class="section-block">
        <div class="section-header"><span>OK</span><h2>Responsavel</h2></div>
        <p><strong>Nome:</strong> {{ responsavel_nome|default:'-' }}</p>
      </section>
      <section class="section-block">
        <div class="section-header"><span>OK</span><h2>Aventureiros ate aqui</h2></div>
        {% if current_incomplete %}
          <p>A ficha atual está incompleta e não será finalizada, a menos que você complete todas as etapas dela.</p>
        {% endif %}
        {% for av in aventures_preview %}
          <article class="summary-card">
            <div>
              {% if av.inscricao.foto_3x4 %}
                <img class="summary-photo" src="{{ av.inscricao.foto_3x4 }}" alt="Foto de {{ av.inscricao.nome_completo|default:'Aventureiro' }}" />
              {% else %}
                <div class="summary-photo-fallback">Sem foto</div>
              {% endif %}
            </div>
            <div>
              <p><strong>{{ av.inscricao.nome_completo|default:'Sem nome' }}</strong></p>
              <p>Ficha de inscricao <strong>✔</strong></p>
              <p>Ficha medica <strong>✔</strong></p>
              <p>Declaracao medica <strong>✔</strong></p>
              <p>Termo de imagem <strong>✔</strong></p>
            </div>
          </article>
        {% empty %}
          <p>Nenhum aventureiro adicionado.</p>
        {% endfor %}
      </section>
      <div class="status" aria-live="polite">{% for message in messages %}<p data-state="{{ message.tags }}">{{ message }}</p>{% endfor %}</div>
      <div class="action-row">
        {% if can_finalize_cadastro %}
        <form method="post">
          {% csrf_token %}
          <input type="hidden" name="action" value="finalizar" />
          <button class="primary" type="submit">Finalizar</button>
        </form>
        {% else %}
          <span class="panel-note">O botão <strong>Finalizar</strong> será liberado quando todos os {{ target_aventureiros_count }} aventureiros forem preenchidos.</span>
        {% endif %}
        {% if can_add_more_aventureiros %}
        <form method="post">
          {% csrf_token %}
          <input type="hidden" name="action" value="add_more" />
          <button class="secondary" type="submit">
            {% if remaining_aventureiros_count > 0 %}
              Cadastrar próximo aventureiro (faltam {{ remaining_aventureiros_count }})
            {% else %}
              Adicionar mais um aventureiro
            {% endif %}
          </button>
        </form>
        {% else %}
          <span class="panel-note">Quantidade informada já atingida. Revise e finalize.</span>
        {% endif %}
      </div>
    </main>
  </div>
</body>
</html>
