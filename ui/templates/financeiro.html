<!DOCTYPE html>
{% load static %}
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Financeiro</title>
  <link rel="stylesheet" href="{% static 'css/styles.css' %}" />
  <style>
    .financeiro-tabs { display:flex; gap:.6rem; flex-wrap:wrap; margin-bottom:1rem; }
    .financeiro-tab {
      display:inline-flex; align-items:center; justify-content:center;
      padding:.65rem .9rem; border-radius:10px; border:1px solid #cbd5e1;
      background:#fff; color:#0f172a; text-decoration:none; font-weight:600;
    }
    .financeiro-tab.is-active {
      background:#0f172a; color:#fff; border-color:#0f172a;
    }
    .financeiro-grid { display:grid; grid-template-columns: 1.2fr auto; gap:.75rem; align-items:end; }
    .financeiro-grid label { font-size:.9rem; color:#334155; }
    .financeiro-grid select { width:100%; padding:.75rem .85rem; border:1px solid #cbd5e1; border-radius:10px; }
    .mensalidades-list { margin-top: 1rem; }
    .mensalidades-list table { width:100%; border-collapse: collapse; }
    .mensalidades-list th, .mensalidades-list td { padding:.7rem .6rem; border-bottom:1px solid #e2e8f0; text-align:left; }
    .badge-status {
      display:inline-flex; padding:.2rem .55rem; border-radius:999px; font-size:.75rem; font-weight:700;
      background:#fef3c7; color:#92400e; border:1px solid #fcd34d;
    }
    @media (max-width: 768px) {
      .financeiro-grid { grid-template-columns: 1fr; }
      .financeiro-grid .primary { width:100%; }
    }
  </style>
</head>
<body class="painel-page">
  {% include '_painel_sidebar.html' %}
  <main class="painel-content">
    <header class="painel-header">
      <h2>Financeiro</h2>
      <p>Módulo inicial para geração e visualização de mensalidades.</p>
    </header>

    <section class="painel-card">
      <div class="status" aria-live="polite">
        {% for message in messages %}
          <p data-state="{{ message.tags }}">{{ message }}</p>
        {% empty %}
          <p data-state="info">Selecione um aventureiro e clique em gerar mensalidades.</p>
        {% endfor %}
      </div>
    </section>

    <section class="painel-card">
      <div class="financeiro-tabs" role="tablist" aria-label="Seções do financeiro">
        <a class="financeiro-tab is-active" href="{% url 'accounts:financeiro' %}" aria-current="page">Mensalidades</a>
      </div>

      <form method="post">
        {% csrf_token %}
        <input type="hidden" name="action" value="gerar_mensalidades" />
        <div class="financeiro-grid">
          <div>
            <label for="aventureiro_id">Aventureiro</label>
            <select id="aventureiro_id" name="aventureiro_id" required>
              <option value="">Selecione...</option>
              {% for av in aventureiros %}
                <option value="{{ av.pk }}"{% if selected_aventureiro_id == av.pk|stringformat:'s' %} selected{% endif %}>
                  {{ av.nome }}{% if av.responsavel and av.responsavel.user %} (Resp.: {{ av.responsavel.user.username }}){% endif %}
                </option>
              {% endfor %}
            </select>
          </div>
          <button type="submit" class="primary">Gerar mensalidades</button>
        </div>
      </form>

      <div class="mensalidades-list">
        {% if selected_aventureiro %}
          <h3 style="margin-bottom:.75rem;">{{ selected_aventureiro.nome }}</h3>
          {% if mensalidades %}
            <table>
              <thead>
                <tr>
                  <th>Competência</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody>
                {% for item in mensalidades %}
                  <tr>
                    <td>{{ item.competencia }}</td>
                    <td><span class="badge-status">{{ item.status }}</span></td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          {% else %}
            <p class="panel-note">Nenhuma mensalidade gerada ainda para este aventureiro.</p>
          {% endif %}
        {% else %}
          <p class="panel-note">A listagem das mensalidades aparecerá abaixo após selecionar um aventureiro.</p>
        {% endif %}
      </div>
    </section>
  </main>
</body>
</html>
